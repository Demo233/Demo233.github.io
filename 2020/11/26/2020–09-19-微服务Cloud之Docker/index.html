<!-- build time:Thu Nov 26 2020 16:59:19 GMT+0000 (GMT) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>微服务Cloud之Docker | zyh</title><meta name="description" content="Author：EricVersion：9.0.1From : 转载看到Eric哥们在b站中分享的Docker视频，觉得讲的很好，这里提供一下讲义方便大家学习。[TOC] 一、引言 1.1 环境不一致我本地运行没问题啊：由于环境不一致，导致相同的程序，运行结果却不一致。 1.2 隔离性哪个哥们又写死循环了，怎么这么卡：在多用户的操作系统下，会因为其他用户的操作失误影响到你自己编写的程序。 1.3 弹"><meta name="keywords" content="Docker"><meta property="og:type" content="article"><meta property="og:title" content="微服务Cloud之Docker"><meta property="og:url" content="yihao.ml/2020/11/26/2020–09-19-微服务Cloud之Docker/index.html"><meta property="og:site_name" content="YIHAO&#39;S BLOG"><meta property="og:description" content="Author：EricVersion：9.0.1From : 转载看到Eric哥们在b站中分享的Docker视频，觉得讲的很好，这里提供一下讲义方便大家学习。[TOC] 一、引言 1.1 环境不一致我本地运行没问题啊：由于环境不一致，导致相同的程序，运行结果却不一致。 1.2 隔离性哪个哥们又写死循环了，怎么这么卡：在多用户的操作系统下，会因为其他用户的操作失误影响到你自己编写的程序。 1.3 弹"><meta property="og:locale" content="default"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1586333742105.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1586340594252.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1586340639934.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1586420176720.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588671760385.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588674040060.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588677492583.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232643961.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232614918.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232754318.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232800931.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232842803.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232910197.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232922638.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588681196639.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708233023116.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708233031967.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588681954779.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588681970621.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588682011820.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588682092002.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588683585249.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588684490466.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588684458028.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588685220324.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588686481506.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588686489821.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588686591351.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588686553880.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588687382594.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588693533099.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588696879059.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588697752850.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588697770621.png"><meta property="og:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1588700462690.png"><meta property="og:updated_time" content="2020-11-26T16:58:58.968Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="微服务Cloud之Docker"><meta name="twitter:description" content="Author：EricVersion：9.0.1From : 转载看到Eric哥们在b站中分享的Docker视频，觉得讲的很好，这里提供一下讲义方便大家学习。[TOC] 一、引言 1.1 环境不一致我本地运行没问题啊：由于环境不一致，导致相同的程序，运行结果却不一致。 1.2 隔离性哪个哥们又写死循环了，怎么这么卡：在多用户的操作系统下，会因为其他用户的操作失误影响到你自己编写的程序。 1.3 弹"><meta name="twitter:image" content="http://qgw3wcroi.hn-bkt.clouddn.com/1586333742105.png"><link rel="canonical" href="yihao.ml/2020/11/26/2020–09-19-微服务Cloud之Docker/index.html"><link rel="alternate" href="/atom.xml" title="YIHAO&#39;S BLOG" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.css"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/Demo233" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://www.weibo.com/u/5592904662/home" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/cnnqjban521" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.facebook.com/yihao.zhao.7" target="_blank" title="Facebook" data-toggle="tooltip" data-placement="top"><i class="icon icon-facebook"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Autodesk/">Autodesk</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/">微服务</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/游戏开发/">游戏开发</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/物联网/">物联网</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法与数据结构/">算法与数据结构</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/">编程语言</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/自动化测试/">自动化测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anaconda/">Anaconda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azkaban/">Azkaban</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDH/">CDH</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DataTable/">DataTable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Editor/">Editor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FFmpeg/">FFmpeg</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FTP/">FTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/">Flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flume/">Flume</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Forge/">Forge</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HBase/">HBase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDFS/">HDFS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/">Hadoop</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hbase/">Hbase</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/">Hibernate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/">Hive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hue/">Hue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/InfluxDB/">InfluxDB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekyll/">Jekyll</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MapReduce/">MapReduce</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MatLab/">MatLab</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/">Maven</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Minecraft/">Minecraft</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/">Mybatis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJS/">NodeJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python3/">Python3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/R/">R</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/">RPC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberry-Pi/">Raspberry Pi</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scala/">Scala</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Selenium/">Selenium</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shiro/">Shiro</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/">Spark</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storm/">Storm</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Struts2/">Struts2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/">Ubuntu</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/">Vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/">WebSocket</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wow/">Wow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ceph/">ceph</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k-means/">k-means</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zTree/">zTree</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图/">图</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/递归/">递归</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/问题总结/">问题总结</a><span class="tag-list-count">13</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/ActiveMQ/" style="font-size:13px">ActiveMQ</a> <a href="/tags/Anaconda/" style="font-size:13px">Anaconda</a> <a href="/tags/Azkaban/" style="font-size:13px">Azkaban</a> <a href="/tags/C/" style="font-size:13px">C</a> <a href="/tags/CDH/" style="font-size:13.57px">CDH</a> <a href="/tags/DataTable/" style="font-size:13px">DataTable</a> <a href="/tags/Docker/" style="font-size:13.29px">Docker</a> <a href="/tags/Editor/" style="font-size:13px">Editor</a> <a href="/tags/FFmpeg/" style="font-size:13.14px">FFmpeg</a> <a href="/tags/FTP/" style="font-size:13px">FTP</a> <a href="/tags/Flink/" style="font-size:13px">Flink</a> <a href="/tags/Flume/" style="font-size:13.14px">Flume</a> <a href="/tags/Forge/" style="font-size:13px">Forge</a> <a href="/tags/Git/" style="font-size:13.14px">Git</a> <a href="/tags/HBase/" style="font-size:13px">HBase</a> <a href="/tags/HDFS/" style="font-size:13px">HDFS</a> <a href="/tags/Hadoop/" style="font-size:13.43px">Hadoop</a> <a href="/tags/Hbase/" style="font-size:13.29px">Hbase</a> <a href="/tags/Hibernate/" style="font-size:13px">Hibernate</a> <a href="/tags/Hive/" style="font-size:13.14px">Hive</a> <a href="/tags/Hue/" style="font-size:13px">Hue</a> <a href="/tags/InfluxDB/" style="font-size:13px">InfluxDB</a> <a href="/tags/JVM/" style="font-size:13px">JVM</a> <a href="/tags/Java/" style="font-size:13px">Java</a> <a href="/tags/Jekyll/" style="font-size:13.14px">Jekyll</a> <a href="/tags/Kafka/" style="font-size:13.14px">Kafka</a> <a href="/tags/Linux/" style="font-size:13px">Linux</a> <a href="/tags/MapReduce/" style="font-size:13.43px">MapReduce</a> <a href="/tags/MatLab/" style="font-size:13.14px">MatLab</a> <a href="/tags/Maven/" style="font-size:13.14px">Maven</a> <a href="/tags/Minecraft/" style="font-size:13px">Minecraft</a> <a href="/tags/Mybatis/" style="font-size:13px">Mybatis</a> <a href="/tags/NIO/" style="font-size:13px">NIO</a> <a href="/tags/NodeJS/" style="font-size:13px">NodeJS</a> <a href="/tags/Python3/" style="font-size:13.29px">Python3</a> <a href="/tags/R/" style="font-size:13.14px">R</a> <a href="/tags/RPC/" style="font-size:13px">RPC</a> <a href="/tags/Raspberry-Pi/" style="font-size:13.29px">Raspberry Pi</a> <a href="/tags/Redis/" style="font-size:13.29px">Redis</a> <a href="/tags/Scala/" style="font-size:13.29px">Scala</a> <a href="/tags/Selenium/" style="font-size:13px">Selenium</a> <a href="/tags/Shiro/" style="font-size:13px">Shiro</a> <a href="/tags/Spark/" style="font-size:13.57px">Spark</a> <a href="/tags/Spring/" style="font-size:13.29px">Spring</a> <a href="/tags/Storm/" style="font-size:13.29px">Storm</a> <a href="/tags/Struts2/" style="font-size:13px">Struts2</a> <a href="/tags/Ubuntu/" style="font-size:13.86px">Ubuntu</a> <a href="/tags/Vue/" style="font-size:13px">Vue</a> <a href="/tags/WebSocket/" style="font-size:13.14px">WebSocket</a> <a href="/tags/Wow/" style="font-size:13px">Wow</a> <a href="/tags/Zookeeper/" style="font-size:13px">Zookeeper</a> <a href="/tags/ceph/" style="font-size:13px">ceph</a> <a href="/tags/hive/" style="font-size:13px">hive</a> <a href="/tags/k-means/" style="font-size:13px">k-means</a> <a href="/tags/kafka/" style="font-size:13.14px">kafka</a> <a href="/tags/zTree/" style="font-size:13px">zTree</a> <a href="/tags/图/" style="font-size:13.71px">图</a> <a href="/tags/递归/" style="font-size:13.14px">递归</a> <a href="/tags/问题总结/" style="font-size:14px">问题总结</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">5</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/算法与数据结构/">算法与数据结构</a></p><p class="item-title"><a href="/2020/11/26/2020年11月26日23:52:26_跳表/" class="title">跳表</a></p><p class="item-date"><time datetime="2020-11-26T16:58:58.970Z" itemprop="datePublished">2020-11-26</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/算法与数据结构/">算法与数据结构</a></p><p class="item-title"><a href="/2020/11/26/2020年11月24日22:58:10_邻接表有向图/" class="title">邻接表有向图</a></p><p class="item-date"><time datetime="2020-11-26T16:58:58.970Z" itemprop="datePublished">2020-11-26</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/算法与数据结构/">算法与数据结构</a></p><p class="item-title"><a href="/2020/11/26/2020年11月22日14:11:18_邻接矩阵有向图/" class="title">邻接矩阵有向图</a></p><p class="item-date"><time datetime="2020-11-26T16:58:58.970Z" itemprop="datePublished">2020-11-26</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/其他/">其他</a></p><p class="item-title"><a href="/2020/11/26/2020年11月15日14:11:53_使用docker部署hadoop/" class="title">Docker部署hadoop</a></p><p class="item-date"><time datetime="2020-11-26T16:58:58.969Z" itemprop="datePublished">2020-11-26</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/算法与数据结构/">算法与数据结构</a></p><p class="item-title"><a href="/2020/11/26/2020年11月21日22:45:32_邻接矩阵无向图/" class="title">邻接矩阵无向图</a></p><p class="item-date"><time datetime="2020-11-26T16:58:58.969Z" itemprop="datePublished">2020-11-26</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-2020–09-19-微服务Cloud之Docker" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">微服务Cloud之Docker</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2020/11/26/2020–09-19-微服务Cloud之Docker/" class="article-date"><time datetime="2020-11-26T16:58:58.968Z" itemprop="datePublished">2020-11-26</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/微服务/">微服务</a></span> <span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link" href="/tags/Docker/">Docker</a></span> <span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/11/26/2020–09-19-微服务Cloud之Docker/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1586333742105.png" alt="1586333742105"></p><blockquote><p>Author：Eric</p><p>Version：9.0.1</p><p>From : 转载</p></blockquote><p>看到Eric哥们在b站中分享的Docker视频，觉得讲的很好，这里提供一下讲义方便大家学习。</p><p>[TOC]</p><h3 id="一-引言"><a class="markdownIt-Anchor" href="#一-引言"></a> 一、引言</h3><hr><h4 id="11-环境不一致"><a class="markdownIt-Anchor" href="#11-环境不一致"></a> 1.1 环境不一致</h4><blockquote><p>我本地运行没问题啊：由于环境不一致，导致相同的程序，运行结果却不一致。</p></blockquote><h4 id="12-隔离性"><a class="markdownIt-Anchor" href="#12-隔离性"></a> 1.2 隔离性</h4><blockquote><p>哪个哥们又写死循环了，怎么这么卡：在多用户的操作系统下，会因为其他用户的操作失误影响到你自己编写的程序。</p></blockquote><h4 id="13-弹性伸缩"><a class="markdownIt-Anchor" href="#13-弹性伸缩"></a> 1.3 弹性伸缩</h4><blockquote><p>淘宝在双11，用户量暴增：需要很多很多的运维人员去增加部署的服务器，运维成本过高。</p></blockquote><h4 id="14-学习成本"><a class="markdownIt-Anchor" href="#14-学习成本"></a> 1.4 学习成本</h4><blockquote><p>学习一门技术，得先安装啊：学习每一门技术都要先安装响应的软件，但是还有他所依赖的各种环境，安装软件成本快高过学习成本啦。</p></blockquote><h3 id="二-docker介绍"><a class="markdownIt-Anchor" href="#二-docker介绍"></a> 二、Docker介绍</h3><hr><h4 id="21-docker的由来"><a class="markdownIt-Anchor" href="#21-docker的由来"></a> 2.1 Docker的由来</h4><blockquote><p>Docker 最初是 dotCloud 公司创始人Solomon Hykes 在法国期间发起的一个公司内部项目。</p><p>2010年的专门做PAAS平台，但是到了2013年的时候，像亚马逊，微软，Google都开始做PAAS平台。</p><p>到了2013年，公司资金链断裂，不得不倒闭，于是将公司内的核心技术对外开源，核心技术就是Docker。</p><p>由于开源了Docker，到了2014年的时候，得到了各轮融资，于是公司开始全神贯注的维护Docker。</p></blockquote><table><thead><tr><th style="text-align:center">Docker主要作者-Solomon</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1586340594252.png" alt="1586340594252"></td></tr></tbody></table><table><thead><tr><th style="text-align:center">现在Solomon已经离开了维护Docker的团队</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1586340639934.png" alt="1586340639934"></td></tr></tbody></table><h4 id="22-docker的思想"><a class="markdownIt-Anchor" href="#22-docker的思想"></a> 2.2 Docker的思想</h4><blockquote><ul><li><p>封装：将需要的操作系统，环境，软件封装到一个镜像中。</p></li><li><p>标准化：</p><ul><li>运输的标准化：Docker提供了中央仓库，所有官方的镜像都放在了这个中央仓库中，当需要使用某一个镜像时，通过相应的方式拉取即可。</li><li>命令的标准化：Docker提供了一些列的命令，帮助我们去获取镜像，管理容器等等操作。</li><li>提供了REST的API：基于标准REST的API衍生出了很多的图形化界面，如Rancher等。</li></ul></li><li><p>隔离性：Docker在运行镜像时，会在Linux的内核中，单独的开辟一片空间，这片空间不会影响到其他程序。</p></li></ul></blockquote><h3 id="三-docker的安装"><a class="markdownIt-Anchor" href="#三-docker的安装"></a> 三、Docker的安装</h3><hr><h4 id="31-下载docker依赖的环境"><a class="markdownIt-Anchor" href="#31-下载docker依赖的环境"></a> 3.1 下载Docker依赖的环境</h4><blockquote><p>安装Docker，需要先将依赖的环境全部下载，就像Maven依赖JDK一样。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><h4 id="32-指定docker镜像源"><a class="markdownIt-Anchor" href="#32-指定docker镜像源"></a> 3.2 指定Docker镜像源</h4><blockquote><p>默认情况下，下载Docker会从国外服务器下载，速度较慢，我们可以设置为阿里云镜像源，速度更快。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h4 id="33-安装docker"><a class="markdownIt-Anchor" href="#33-安装docker"></a> 3.3 安装Docker</h4><blockquote><p>采用yum的方式安装。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure><p>Docker 安装不了可能是源的问题,我的机器是ubuntu，这里参考了链接完成了安装https://www.runoob.com/docker/ubuntu-docker-install.html</p><h4 id="34-启动docker并测试"><a class="markdownIt-Anchor" href="#34-启动docker并测试"></a> 3.4 启动Docker并测试</h4><blockquote><p>安装成功后，需要手动启动，设置为开机自启，并测试。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动Docker服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="comment"># 设置开机自动启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><h3 id="四-docker的中央仓库重点"><a class="markdownIt-Anchor" href="#四-docker的中央仓库重点"></a> 四、Docker的中央仓库【<code>重点</code>】</h3><hr><blockquote><ul><li><p>Docker官方的中央仓库：这个仓库是镜像最全的，但是下载速度较慢。</p><p><a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p></li><li><p>国内的镜像网站：网易蜂巢，daoCloud等，下载速度快，但是镜像相对不全。</p><p><a href="https://c.163yun.com/hub#/home" target="_blank" rel="noopener">https://c.163yun.com/hub#/home</a></p><p><a href="http://hub.daocloud.io/" target="_blank" rel="noopener">http://hub.daocloud.io/</a> （推荐使用）</p></li><li><p>在公司内部会采用私服的方式拉取镜像，需要添加配置，如下……</p></li></ul></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 需要创建或修改/etc/docker/daemon.json，并添加如下内容，"ip:port"可以编写多个。</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"registry-mirrors"</span>: [<span class="string">"https://registry.docker-cn.com"</span>],</span><br><span class="line">	<span class="attr">"insecure-registries"</span>: [<span class="string">"ip:port"</span>]   </span><br><span class="line">&#125;</span><br><span class="line"># 重启docker服务</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="五-镜像的操作"><a class="markdownIt-Anchor" href="#五-镜像的操作"></a> 五、镜像的操作</h3><hr><h4 id="51-拉取镜像"><a class="markdownIt-Anchor" href="#51-拉取镜像"></a> 5.1 拉取镜像</h4><blockquote><p>从中央仓库拉取镜像到本地</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull 镜像名称[:tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 举个栗子：docker pull daocloud.io/library/tomcat:8.5.15-jre8</span></span><br></pre></td></tr></table></figure><h4 id="52-查看本地全部镜像"><a class="markdownIt-Anchor" href="#52-查看本地全部镜像"></a> 5.2 查看本地全部镜像</h4><blockquote><p>查看本地已经安装过的镜像信息，包含标识，名称，版本，更新时间，大小</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><h4 id="53-删除本地镜像"><a class="markdownIt-Anchor" href="#53-删除本地镜像"></a> 5.3 删除本地镜像</h4><blockquote><p>镜像会占用磁盘空间，可以直接手动删除，表示通过查看获取</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi 镜像的标识 | 镜像名称:tag</span><br><span class="line">docker rmi b8dfe9ade316</span><br><span class="line">docker rmi daocloud.io/library/tomcat:8.5.15-jre8</span><br></pre></td></tr></table></figure><h4 id="54-镜像的导入导出"><a class="markdownIt-Anchor" href="#54-镜像的导入导出"></a> 5.4 镜像的导入导出</h4><blockquote><ul><li>如果出现网络故障，可以采过硬盘的方式传输镜像，虽然不规范，但是有效。</li><li>但是这种方式导出的镜像名称和版本都是null，需要手动修改</li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将本地的镜像导出</span></span><br><span class="line">docker save -o 导出的路径 镜像id</span><br><span class="line">doeker save -o /usr/<span class="built_in">local</span>/abc.tar b8dfe9ade316</span><br><span class="line"><span class="comment"># 加载本地的镜像文件</span></span><br><span class="line">docker load -i 镜像文件</span><br><span class="line">docker load -i /usr/<span class="built_in">local</span>/abc.tar</span><br><span class="line"><span class="comment"># 修改镜像名称</span></span><br><span class="line">docker tag 镜像id 新镜像名称:版本</span><br><span class="line">docker tag b8dfe9ade316  mytomcat:1.0</span><br></pre></td></tr></table></figure><h3 id="六-容器操作重点"><a class="markdownIt-Anchor" href="#六-容器操作重点"></a> 六、容器操作【<code>重点</code>】</h3><hr><h4 id="61-运行容器"><a class="markdownIt-Anchor" href="#61-运行容器"></a> 6.1 运行容器</h4><blockquote><p>运行容器需要指定具体镜像，如果镜像不存在，会直接下载</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单操作</span></span><br><span class="line">docker run 镜像的标识 | 镜像名称[:tag]</span><br><span class="line">docker run b8dfe9ade316</span><br><span class="line">docker run daocloud.io/library/tomcat:8.5.15-jre8</span><br><span class="line"><span class="comment"># 常用的参数</span></span><br><span class="line">docker run -d -p 宿主机端口:容器端口 --name 容器名称 镜像的标识|镜像名称[:tag]</span><br><span class="line">docker run -d -p 8090:8080 --name my_container b8dfe9ade316</span><br><span class="line"><span class="comment"># -d：代表后台运行容器</span></span><br><span class="line"><span class="comment"># -p 宿主机端口:容器端口：为了映射当前Linux的端口和容器的端口</span></span><br><span class="line"><span class="comment"># --name 容器名称：指定容器的名称</span></span><br></pre></td></tr></table></figure><h4 id="62-查看正在运行的容器"><a class="markdownIt-Anchor" href="#62-查看正在运行的容器"></a> 6.2 查看正在运行的容器</h4><blockquote><p>查看全部正在运行的容器信息</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps [-qa]</span><br><span class="line"><span class="comment"># -a：查看全部的容器，包括没有运行</span></span><br><span class="line"><span class="comment"># -q：只查看容器的标识</span></span><br></pre></td></tr></table></figure><h4 id="63-查看容器日志"><a class="markdownIt-Anchor" href="#63-查看容器日志"></a> 6.3 查看容器日志</h4><blockquote><p>查看容器日志，以查看容器运行的信息</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f 容器id</span><br><span class="line"><span class="comment"># -f：可以滚动查看日志的最后几行</span></span><br></pre></td></tr></table></figure><h4 id="64-进入容器内容部"><a class="markdownIt-Anchor" href="#64-进入容器内容部"></a> 6.4 进入容器内容部</h4><blockquote><p>可以进入容器内部进行操作</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 容器id bash</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器名称 bash</span><br></pre></td></tr></table></figure><h4 id="65-复制内容到容器"><a class="markdownIt-Anchor" href="#65-复制内容到容器"></a> 6.5 复制内容到容器</h4><blockquote><p>将宿主机的文件复制到容器内部的指定目录</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 文件名称 容器id:容器内部路径</span><br></pre></td></tr></table></figure><h4 id="66-重启启动停止删除容器"><a class="markdownIt-Anchor" href="#66-重启启动停止删除容器"></a> 6.6 重启&amp;启动&amp;停止&amp;删除容器</h4><blockquote><p>容器的启动，停止，删除等操作，后续经常会使用到</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新启动容器</span></span><br><span class="line">docker restart 容器id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动停止运行的容器</span></span><br><span class="line">docker start 容器id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止指定的容器（删除容器前，需要先停止容器）</span></span><br><span class="line">docker stop 容器id</span><br><span class="line"><span class="comment"># 停止全部容器</span></span><br><span class="line">docker stop $(docker ps -qa)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定容器</span></span><br><span class="line">docker rm 容器id</span><br><span class="line"><span class="comment"># 删除全部容器</span></span><br><span class="line">docker rm $(docker ps -qa)</span><br></pre></td></tr></table></figure><h3 id="七-docker应用"><a class="markdownIt-Anchor" href="#七-docker应用"></a> 七、Docker应用</h3><hr><h4 id="71-docker安装tomcat"><a class="markdownIt-Anchor" href="#71-docker安装tomcat"></a> 7.1 Docker安装Tomcat</h4><blockquote><p>运行Tomcat容器，为部署SSM工程做准备</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:8080 --name tomcat daocloud.io/library/tomcat:8.5.15-jre8</span><br></pre></td></tr></table></figure><h4 id="72-docker安装mysql"><a class="markdownIt-Anchor" href="#72-docker安装mysql"></a> 7.2 Docker安装MySQL</h4><blockquote><p>运行MySQL容器，为部署SSM工程做准备</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3366:3306 --name mysql -e MYSQL_ROOT_PASSWORD=root daocloud.io/library/mysql:5.7.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 宿主机中通过 3366连接 容器中的mysql</span></span><br><span class="line">[root@localhost logs]<span class="comment"># mysql -uroot -P 3366 -proot -h 192.168.1.135</span></span><br></pre></td></tr></table></figure><h4 id="73-部署ssm工程"><a class="markdownIt-Anchor" href="#73-部署ssm工程"></a> 7.3 部署SSM工程</h4><blockquote><ul><li>修改SSM工程环境，设置为Linux中Docker容器的信息</li><li>通过Maven的package重新打成war包</li><li>将Windows下的war包复制到Linux中</li><li>通过docker命令将宿主机的war包复制到容器内部</li><li>测试访问SSM工程</li></ul></blockquote><h3 id="八-数据卷重点"><a class="markdownIt-Anchor" href="#八-数据卷重点"></a> 八、数据卷【<code>重点</code>】</h3><hr><blockquote><ul><li><p>为部署SSM的工程，需要使用到Docker的cp命令将宿主机内的ssm.war文件复制到容器内部，操作麻烦。</p></li><li><p><a href>数据卷</a>：</p></li><li><p>将宿主机的一个目录映射到容器的一个目录中。</p></li><li><p>可以在宿主机中操作目录中的内容，容器内部映射的文件会跟着一起改变。</p></li></ul></blockquote><h4 id="81-创建数据卷"><a class="markdownIt-Anchor" href="#81-创建数据卷"></a> 8.1 创建数据卷</h4><blockquote><p>创建数据卷之后，默认会存放在一个目录下 /var/lib/docker/volumes/数据卷名称/_data</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create 数据卷名称</span><br></pre></td></tr></table></figure><h4 id="82-查看数据卷详情"><a class="markdownIt-Anchor" href="#82-查看数据卷详情"></a> 8.2 查看数据卷详情</h4><blockquote><p>查看数据卷的详细信息，可以查询到存放路径，创建时间等等</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect 数据卷名称</span><br></pre></td></tr></table></figure><h4 id="83-查看全部数据卷"><a class="markdownIt-Anchor" href="#83-查看全部数据卷"></a> 8.3 查看全部数据卷</h4><blockquote><p>查看全部数据卷信息</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure><h4 id="84-删除数据卷"><a class="markdownIt-Anchor" href="#84-删除数据卷"></a> 8.4 删除数据卷</h4><blockquote><p>删除指定数据卷</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm 数据卷名称</span><br></pre></td></tr></table></figure><h4 id="85-容器映射数据卷"><a class="markdownIt-Anchor" href="#85-容器映射数据卷"></a> 8.5 容器映射数据卷</h4><blockquote><p>映射有两种方式：</p><ul><li>通过数据卷名称映射，如果数据卷不存在。Docker会帮你自动创建，会将容器内部自带的文件，存储在默认的存放路径中。</li><li>通过路径映射数据卷，直接指定一个路径作为数据卷的存放位置。但是这个路径下是空的。</li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过数据卷名称映射</span></span><br><span class="line">docker run -v 数据卷名称:容器内部的路径 镜像id</span><br><span class="line">docker run -v webapps2004:/usr/<span class="built_in">local</span>/tomcat/webappss 镜像id</span><br><span class="line"><span class="comment"># 通过路径映射数据卷</span></span><br><span class="line">docker run -v 路径:容器内部的路径 镜像id</span><br><span class="line">docker run -v /usr/<span class="built_in">local</span>/tomcat_webapps2004:/usr/<span class="built_in">local</span>/tomcat/webapps 镜像id</span><br></pre></td></tr></table></figure><h3 id="九-dockerfile自定义镜像重点"><a class="markdownIt-Anchor" href="#九-dockerfile自定义镜像重点"></a> 九、Dockerfile自定义镜像【<code>重点</code>】</h3><hr><blockquote><p>我们可以从中央仓库下载一个镜像，也可以自己手动去制作一个镜像，需要通过Dockerfile去指定自定义镜像的信息</p></blockquote><h4 id="91-dockerfile"><a class="markdownIt-Anchor" href="#91-dockerfile"></a> 9.1 Dockerfile</h4><blockquote><p>创建自定义镜像就需要创建一个Dockerfile，如下为Dockerfile的常用配置</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from: 指定当前自定义镜像依赖的环境</span><br><span class="line">copy: 将相对路径下的内容复制到自定义镜像中</span><br><span class="line">workdir: 声明镜像的默认工作目录</span><br><span class="line">run: 执行的命令，可以编写多个</span><br><span class="line">cmd: 需要执行的命令（在workdir下执行的，cmd可以写多个，但是只以最后一个为准）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 举个例子，制作SSM容器镜像，而且ssm.war要放在Dockerfile的同级目录下</span></span><br><span class="line">from daocloud.io/library/tomcat:8.5.15-jre8</span><br><span class="line">copy ssm.war /usr/<span class="built_in">local</span>/tomcat/webapps</span><br></pre></td></tr></table></figure><h4 id="92-通过dockerfile制作镜像"><a class="markdownIt-Anchor" href="#92-通过dockerfile制作镜像"></a> 9.2 通过Dockerfile制作镜像</h4><blockquote><p>编写完Dockerfile后需要Dockerfile所在目录通过命令将其制作为镜像，注意最后的 <a href>.</a> 代表当前目录。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t 镜像名称[:tag] .</span><br></pre></td></tr></table></figure><h3 id="十-docker-compose重点"><a class="markdownIt-Anchor" href="#十-docker-compose重点"></a> 十. Docker-Compose【<code>重点</code>】</h3><hr><blockquote><ul><li>运行一个容器，我们需要添加大量的参数，可以通过Docker-Compose文件配置参数。</li><li>参数信息通过docker-compose.yml文件去维护。</li><li>Docker-Compose可以批量管理容器。</li></ul></blockquote><h4 id="101-下载并安装docker-compose"><a class="markdownIt-Anchor" href="#101-下载并安装docker-compose"></a> 10.1 下载并安装Docker-Compose</h4><h5 id="1011-下载docker-compose"><a class="markdownIt-Anchor" href="#1011-下载docker-compose"></a> 10.1.1 下载Docker-Compose</h5><blockquote><p>去github官网搜索docker-compose，下载1.24.1版本的Docker-Compose</p><p>下载路径：<a href>https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64</a></p></blockquote><h5 id="1012-设置权限"><a class="markdownIt-Anchor" href="#1012-设置权限"></a> 10.1.2 设置权限</h5><blockquote><p>需要将DockerCompose文件的名称修改一下，给予DockerCompose文件一个可执行的权限</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv docker-compose-Linux-x86_64 docker-compose</span><br><span class="line">chmod 777 docker-compose</span><br></pre></td></tr></table></figure><h5 id="1013-移动到usrlocalbin目录下"><a class="markdownIt-Anchor" href="#1013-移动到usrlocalbin目录下"></a> 10.1.3 移动到/usr/local/bin目录下</h5><blockquote><p>方便后期操作，将docker-compose文件移动到了/usr/local/bin</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv docker-compose /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure><h5 id="1014-测试"><a class="markdownIt-Anchor" href="#1014-测试"></a> 10.1.4 测试</h5><blockquote><p>在任意目录下输入docker-compose</p></blockquote><table><thead><tr><th style="text-align:center">测试效果</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1586420176720.png" alt="1586420176720"></td></tr></tbody></table><h4 id="102-docker-compose管理mysql和tomcat容器"><a class="markdownIt-Anchor" href="#102-docker-compose管理mysql和tomcat容器"></a> 10.2 Docker-Compose管理MySQL和Tomcat容器</h4><blockquote><ul><li><p>yml文件以key: value方式来指定配置信息</p></li><li><p>多个配置信息以换行+缩进的方式来区分</p></li><li><p>在docker-compose.yml文件中，不要使用制表符</p></li></ul></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  mysql:</span>           <span class="comment"># 服务的名称</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span>   <span class="comment"># 代表只要docker启动，那么这个容器就跟着一起启动</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">daocloud.io/library/mysql:5.7.4</span>  <span class="comment"># 指定镜像路径</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">mysql</span>  <span class="comment"># 指定容器名称</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">3306</span><span class="string">:3306</span>   <span class="comment">#  指定端口号的映射</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      MYSQL_ROOT_PASSWORD:</span> <span class="string">root</span>   <span class="comment"># 指定MySQL的ROOT用户登录密码</span></span><br><span class="line"><span class="attr">      TZ:</span> <span class="string">Asia/Shanghai</span>        <span class="comment"># 指定时区</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">/opt/docker_mysql_tomcat/mysql_data:/var/lib/mysql</span>   <span class="comment"># 映射数据卷</span></span><br><span class="line"><span class="attr">  tomcat:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">daocloud.io/library/tomcat:8.5.15-jre8</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/opt/docker_mysql_tomcat/tomcat_webapps:/usr/local/tomcat/webapps</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/opt/docker_mysql_tomcat/tomcat_logs:/usr/local/tomcat/logs</span></span><br></pre></td></tr></table></figure><h4 id="103-使用docker-compose命令管理容器"><a class="markdownIt-Anchor" href="#103-使用docker-compose命令管理容器"></a> 10.3 使用docker-compose命令管理容器</h4><blockquote><p>在docker-compose.yml文件目录下使用docker-compose的命令时</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 基于docker-compose.yml启动管理的容器</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 关闭并删除容器</span></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 开启|关闭|重启已经存在的由docker-compose维护的容器</span></span><br><span class="line">docker-compose start|stop|restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查看由docker-compose管理的容器</span></span><br><span class="line">docker-compose ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 查看日志</span></span><br><span class="line">docker-compose logs -f</span><br></pre></td></tr></table></figure><h4 id="104-docker-compose配合dockerfile使用"><a class="markdownIt-Anchor" href="#104-docker-compose配合dockerfile使用"></a> 10.4 docker-compose配合Dockerfile使用</h4><blockquote><p>使用docker-compose.yml文件以及Dockerfile文件在生成自定义镜像的同时启动当前镜像，并且由docker-compose去管理容器</p></blockquote><h5 id="1041-docker-compose文件"><a class="markdownIt-Anchor" href="#1041-docker-compose文件"></a> 10.4.1 docker-compose文件</h5><blockquote><p>编写docker-compose.yml文件</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yml文件</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  ssm:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    build:</span>            <span class="comment"># 构建自定义镜像</span></span><br><span class="line"><span class="attr">      context:</span> <span class="string">../</span>      <span class="comment"># 指定dockerfile文件的所在路径</span></span><br><span class="line"><span class="attr">      dockerfile:</span> <span class="string">Dockerfile</span>   <span class="comment"># 指定Dockerfile文件名称</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">ssm:1.0.1</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">ssm</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8081</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      TZ:</span> <span class="string">Asia/Shanghai</span></span><br></pre></td></tr></table></figure><h5 id="1042-dockerfile文件"><a class="markdownIt-Anchor" href="#1042-dockerfile文件"></a> 10.4.2 Dockerfile文件</h5><blockquote><p>编写Dockerfile文件</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from daocloud.io/library/tomcat:8.5.15-jre8</span><br><span class="line">copy ssm.war /usr/local/tomcat/webapps</span><br></pre></td></tr></table></figure><h5 id="1043-运行"><a class="markdownIt-Anchor" href="#1043-运行"></a> 10.4.3 运行</h5><blockquote><p>测试效果</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以直接启动基于docker-compose.yml以及Dockerfile文件构建的自定义镜像</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"><span class="comment"># 如果自定义镜像不存在，会帮助我们构建出自定义镜像，如果自定义镜像已经存在，会直接运行这个自定义镜像</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新构建自定义镜像</span></span><br><span class="line">docker-compose build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行当前内容，并重新构建</span></span><br><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure><h3 id="十一-docker-ci-cd"><a class="markdownIt-Anchor" href="#十一-docker-ci-cd"></a> 十一. Docker CI、CD</h3><hr><h4 id="111-ci-cd引言"><a class="markdownIt-Anchor" href="#111-ci-cd引言"></a> 11.1 CI、CD引言</h4><blockquote><p>项目部署</p><ul><li>将项目通过maven进行编译打包</li><li>将文件上传到指定的服务器中</li><li>将war包放到tomcat的目录中</li><li>通过Dockerfile将Tomcat和war包转成一个镜像，由DockerCompose去运行容器</li></ul><p>项目更新后，需要将上述流程再次的从头到尾的执行一次，如果每次更新一次都执行一次上述操作，很费时，费力。我们就可以通过CI、CD帮助我们实现持续集成，持续交付和部署。</p></blockquote><h4 id="112-ci介绍"><a class="markdownIt-Anchor" href="#112-ci介绍"></a> 11.2 CI介绍</h4><blockquote><p>CI（continuous intergration）持续集成</p><p>持续集成：编写代码时，完成了一个功能后，立即提交代码到Git仓库中，将项目重新的构建并且测试。</p><ul><li>快速发现错误。</li><li>防止代码偏离主分支。</li></ul></blockquote><h4 id="113-搭建gitlab服务器"><a class="markdownIt-Anchor" href="#113-搭建gitlab服务器"></a> 11.3 搭建Gitlab服务器</h4><blockquote><p>实现CI，需要使用到Gitlab远程仓库，先通过Docker搭建Gitlab</p></blockquote><h5 id="1131-准备工作"><a class="markdownIt-Anchor" href="#1131-准备工作"></a> 11.3.1 准备工作</h5><blockquote><ul><li>创建一个全新的虚拟机，并且至少指定4G的运行内存，4G运行内存是Gitlab推荐的内存大小。</li><li>并且安装Docker以及Docker-Compose</li></ul></blockquote><h5 id="1132-修改ssh的22端口"><a class="markdownIt-Anchor" href="#1132-修改ssh的22端口"></a> 11.3.2 修改ssh的22端口</h5><blockquote><p>将ssh的默认22端口，修改为60022端口，因为Gitlab需要占用22端口</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">  PORT 22 -&gt; 60022</span><br><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure><h5 id="1133-编写docker-composeyml"><a class="markdownIt-Anchor" href="#1133-编写docker-composeyml"></a> 11.3.3 编写docker-compose.yml</h5><blockquote><p>docker-compose.yml文件去安装gitlab（下载和运行的时间比较长的）</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr"> gitlab:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="string">'twang2218/gitlab-ce-zh:11.1.4'</span></span><br><span class="line"><span class="attr">  container_name:</span> <span class="string">"gitlab"</span></span><br><span class="line"><span class="attr">  restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">  privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  hostname:</span> <span class="string">'gitlab'</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">   TZ:</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line"><span class="attr">   GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    external_url 'http://192.168.199.110'</span></span><br><span class="line"><span class="string">    gitlab_rails['time_zone'] = 'Asia/Shanghai'</span></span><br><span class="line"><span class="string">    gitlab_rails['smtp_enable'] = true</span></span><br><span class="line"><span class="string">    gitlab_rails['gitlab_shell_ssh_port'] = 22</span></span><br><span class="line"><span class="string"></span><span class="attr">  ports:</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">'80:80'</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">'443:443'</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">'22:22'</span></span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">/opt/docker_gitlab/config:/etc/gitlab</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">/opt/docker_gitlab/data:/var/opt/gitlab</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">/opt/docker_gitlab/logs:/var/log/gitlab</span></span><br></pre></td></tr></table></figure><h4 id="114-搭建gitlabrunner"><a class="markdownIt-Anchor" href="#114-搭建gitlabrunner"></a> 11.4 搭建GitlabRunner</h4><h5 id="1141-配置私服信息"><a class="markdownIt-Anchor" href="#1141-配置私服信息"></a> 11.4.1 配置私服信息</h5><blockquote><p>创建或修改/etc/docker/daemon.json，并添加如下内容。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">    <span class="string">"https://registry.docker-cn.com"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"insecure-registries"</span>: [</span><br><span class="line">    <span class="string">"baseservice.qfjava.cn:60001"</span> </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>重启两个服务</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h5 id="1142-添加docker-composeyml文件"><a class="markdownIt-Anchor" href="#1142-添加docker-composeyml文件"></a> 11.4.2 添加docker-compose.yml文件</h5><blockquote><ul><li>创建工作目录 /opt/docker_gitlab-runner</li><li>在 /opt/docker_gitlab-runner添加docker-compose.yml文件</li></ul></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  gitlab-runner:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">environment</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">gitlab-runner</span></span><br><span class="line"><span class="attr">    privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./config:/etc/gitlab-runner</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br></pre></td></tr></table></figure><h5 id="1143-在yml文件目录添加环境目录"><a class="markdownIt-Anchor" href="#1143-在yml文件目录添加环境目录"></a> 11.4.3 在yml文件目录添加环境目录</h5><blockquote><p>创建environment目录，在目录中逐个添加各个配置及软件</p></blockquote><blockquote><p>Dockerfile</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">FROM baseservice.qfjava.cn:60001/gitlab-runner:bleeding</span><br><span class="line"># 修改软件源</span><br><span class="line">RUN echo &apos;deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse&apos; &gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    echo &apos;deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse&apos; &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    echo &apos;deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse&apos; &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    echo &apos;deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse&apos; &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    #下面的地址需要根据实际情况变化</span><br><span class="line">    wget https://http.kali.org/kali/pool/main/k/kali-archive-keyring/kali-archive-keyring_2018.2_all.deb --no-check-certificate &amp;&amp; \</span><br><span class="line">    apt install -y ./kali-archive-keyring_2018.2_all.deb &amp;&amp; \</span><br><span class="line">    apt-get update -y &amp;&amp; \</span><br><span class="line">    apt install -y  gnupg  &amp;&amp; \</span><br><span class="line">    apt-get clean</span><br><span class="line"></span><br><span class="line"># 安装 Docker</span><br><span class="line">RUN curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | apt-key add - &amp;&amp; \</span><br><span class="line">    apt-get install -y python-software-properties software-properties-common &amp;&amp; \</span><br><span class="line">    echo &apos;deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable&apos; &gt;&gt; /etc/apt/sources.list.d/docker.list &amp;&amp; \</span><br><span class="line">    apt-get update -y &amp;&amp; \</span><br><span class="line">    apt-get install -y docker-ce</span><br><span class="line"></span><br><span class="line">COPY daemon.json /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line"># 安装 Docker Compose,因为下载不下来，所以我们本地上传一份docker-compose到environment目录</span><br><span class="line">WORKDIR /usr/local/bin</span><br><span class="line">#RUN wget https://raw.githubusercontent.com/topsale/resources/master/docker/docker-compose</span><br><span class="line">COPY docker-compose docker-compose</span><br><span class="line">RUN chmod +x docker-compose</span><br><span class="line"></span><br><span class="line"># 安装 Java</span><br><span class="line">RUN mkdir -p /usr/local/java</span><br><span class="line">WORKDIR /usr/local/java</span><br><span class="line">COPY jdk-8u231-linux-x64.tar.gz /usr/local/java</span><br><span class="line">RUN tar -zxvf jdk-8u231-linux-x64.tar.gz &amp;&amp; \</span><br><span class="line">    rm -fr jdk-8u231-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"># 安装 Maven</span><br><span class="line">RUN mkdir -p /usr/local/maven</span><br><span class="line">WORKDIR /usr/local/maven</span><br><span class="line"># RUN wget https://raw.githubusercontent.com/topsale/resources/master/maven/apache-maven-3.6.3-bin.tar.gz</span><br><span class="line">COPY apache-maven-3.6.3-bin.tar.gz /usr/local/maven</span><br><span class="line">RUN tar -zxvf apache-maven-3.6.3-bin.tar.gz &amp;&amp; \</span><br><span class="line">    rm -fr apache-maven-3.6.3-bin.tar.gz</span><br><span class="line">#需要配置maven 私服的话,不需要就加#注释掉</span><br><span class="line">#COPY settings.xml /usr/local/maven/apache-maven-3.6.3/conf/settings.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 配置环境变量</span><br><span class="line">ENV JAVA_HOME /usr/local/java/jdk1.8.0_231</span><br><span class="line">ENV MAVEN_HOME /usr/local/maven/apache-maven-3.6.3</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin</span><br><span class="line"></span><br><span class="line">WORKDIR /</span><br></pre></td></tr></table></figure><blockquote><p>daemon.json</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://registry.docker-cn.com&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;insecure-registries&quot;: [</span><br><span class="line">    &quot;baseservice.qfjava.cn:60001&quot; </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>docker-compose可执行文件。</p></blockquote><blockquote><p><a href>apache-maven-3.6.3-bin.tar.gz</a>，以及<a href>jdk-8u231-linux-x64.tar.gz</a>压缩包文件。</p></blockquote><h5 id="1144-设置docker权限"><a class="markdownIt-Anchor" href="#1144-设置docker权限"></a> 11.4.4 设置Docker权限</h5><blockquote><ul><li>在宿主机启动docker程序后先执行 <a href>sudo chown root:root /var/run/docker.sock</a>。</li><li>在<a href>/opt/docker_gitlab-runner</a>目录中执行<a href>docker-compose up -d --build</a>启动容器。</li><li>启动容器成功后，添加容器权限，保证容器可以使用宿主机的docker：<a href>docker exec -it gitlab-runner usermod -aG root gitlab-runner</a></li></ul></blockquote><h5 id="1145-注册runner信息到gitlab"><a class="markdownIt-Anchor" href="#1145-注册runner信息到gitlab"></a> 11.4.5 注册Runner信息到gitlab</h5><blockquote><p>注册信息整个过程</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab-runner gitlab-runner register</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入 GitLab 地址</span></span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://192.168.199.109/  <span class="comment"># 根据gitlab地址添加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入 GitLab Token</span></span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">1Lxq_f1NRfCfeNbE5WRh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入 Runner 的说明</span></span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">可以为空</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 Tag，可以用于指定在构建规定的 tag 时触发 ci</span></span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">deploy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里选择 true ，可以用于代码上传后直接执行（根据版本，也会没有次选项）</span></span><br><span class="line">Whether to run untagged builds [<span class="literal">true</span>/<span class="literal">false</span>]:</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里选择 false，可以直接回车，默认为 false（根据版本，也会没有次选项）</span></span><br><span class="line">Whether to lock Runner to current project [<span class="literal">true</span>/<span class="literal">false</span>]:</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择 runner 执行器，这里我们选择的是 shell</span></span><br><span class="line">Please enter the executor: virtualbox, docker+machine, parallels, shell, ssh, docker-ssh+machine, kubernetes, docker, docker-ssh:</span><br><span class="line">shell</span><br></pre></td></tr></table></figure><h4 id="115-整合项目入门测试"><a class="markdownIt-Anchor" href="#115-整合项目入门测试"></a> 11.5 整合项目入门测试</h4><h5 id="1151-创建项目"><a class="markdownIt-Anchor" href="#1151-创建项目"></a> 11.5.1 创建项目</h5><blockquote><p>创建maven工程，添加web.xml文件，编写html页面</p></blockquote><h5 id="1152-编写gitlab-ciyml"><a class="markdownIt-Anchor" href="#1152-编写gitlab-ciyml"></a> 11.5.2 编写.gitlab-ci.yml</h5><blockquote><p>编写<a href>.gitlab-ci.yml</a>文件</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  stage: test</span><br><span class="line">  script:</span><br><span class="line">    - echo first test ci   # 测试回声命令，测试效果</span><br></pre></td></tr></table></figure><h5 id="1153-将maven工程推送到gitlab中"><a class="markdownIt-Anchor" href="#1153-将maven工程推送到gitlab中"></a> 11.5.3 将maven工程推送到gitlab中</h5><blockquote><p>执行git命令推送到Gitlab</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h5 id="1154-查看效果"><a class="markdownIt-Anchor" href="#1154-查看效果"></a> 11.5.4 查看效果</h5><blockquote><p>可以在gitlab中查看到gitlab-ci.yml编写的内容</p></blockquote><table><thead><tr><th style="text-align:center">效果图</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588671760385.png" alt="1588671760385"></td></tr></tbody></table><h4 id="116-完善项目配置"><a class="markdownIt-Anchor" href="#116-完善项目配置"></a> 11.6 完善项目配置</h4><blockquote><p>添加Dockerfile以及docker-compose.yml， 并修改<a href>.gitlab-ci.yml</a>文件</p></blockquote><h5 id="1161-创建dockerfile"><a class="markdownIt-Anchor" href="#1161-创建dockerfile"></a> 11.6.1 创建Dockerfile</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Dockerfile</span><br><span class="line">FROM daocloud.io/library/tomcat:8.5.15-jre8</span><br><span class="line">COPY testci.war /usr/local/tomcat/webapps</span><br></pre></td></tr></table></figure><h5 id="1162-创建docker-composeyml"><a class="markdownIt-Anchor" href="#1162-创建docker-composeyml"></a> 11.6.2 创建docker-compose.yml</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  testci:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">docker</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">testci</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8080</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure><h5 id="1163-修改gitlab-ciyml"><a class="markdownIt-Anchor" href="#1163-修改gitlab-ciyml"></a> 11.6.3 修改.gitlab-ci.yml</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># ci.yml</span><br><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  stage: test</span><br><span class="line">  script:</span><br><span class="line">    - echo first test ci</span><br><span class="line">    - /usr/local/maven/apache-maven-3.6.3/bin/mvn package</span><br><span class="line">    - cp target/testci-1.0-SNAPSHOT.war docker/testci.war</span><br><span class="line">    - docker-compose down</span><br><span class="line">    - docker-compose up -d --build</span><br><span class="line">    - docker rmi $(docker images -qf dangling=true)</span><br></pre></td></tr></table></figure><h5 id="1164-测试"><a class="markdownIt-Anchor" href="#1164-测试"></a> 11.6.4 测试</h5><table><thead><tr><th style="text-align:center">测试效果</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588674040060.png" alt="1588674040060"></td></tr></tbody></table><h4 id="117-cd介绍"><a class="markdownIt-Anchor" href="#117-cd介绍"></a> 11.7 CD介绍</h4><blockquote><p>CD（持续交付，持续部署）</p><p>持续交付：将代码交付给专业的测试团队去测试</p><p>持续部署：可以直接将指定好tag的代码直接部署到生产环境中</p></blockquote><table><thead><tr><th style="text-align:center">CICD图</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588677492583.png" alt="1588677492583"></td></tr></tbody></table><h4 id="118-安装jenkins"><a class="markdownIt-Anchor" href="#118-安装jenkins"></a> 11.8 安装Jenkins</h4><h5 id="1181-编写docker-composeyml"><a class="markdownIt-Anchor" href="#1181-编写docker-composeyml"></a> 11.8.1 编写docker-compose.yml</h5><blockquote><p>官网：<a href="https://www.jenkins.io/" target="_blank" rel="noopener">https://www.jenkins.io/</a></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  jenkins:</span></span><br><span class="line"><span class="attr">   image:</span> <span class="string">jenkins/jenkins</span></span><br><span class="line"><span class="attr">   restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">   container_name:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="attr">   ports:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="number">8888</span><span class="string">:8080</span></span><br><span class="line"><span class="bullet">     -</span> <span class="number">50000</span><span class="string">:50000</span></span><br><span class="line"><span class="attr">   volumes:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">./data:/var/jenkins_home</span></span><br></pre></td></tr></table></figure><h5 id="1182-运行并访问jenkins"><a class="markdownIt-Anchor" href="#1182-运行并访问jenkins"></a> 11.8.2 运行并访问Jenkins</h5><blockquote><p>第一次运行时，会因为data目录没有权限，导致启动失败</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 data</span><br></pre></td></tr></table></figure><blockquote><p>访问http://192.168.199.109:8888</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问速度奇慢无比。。。。。</span><br></pre></td></tr></table></figure><blockquote><p>访问成功后，需要输入密码，可在日志中查看</p></blockquote><table><thead><tr><th>查看日志,以及Jenkins页面</th></tr></thead><tbody><tr><td><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232643961.png" alt="image-20200708232643961"></td></tr><tr><td><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232614918.png" alt="image-20200708232614918"></td></tr></tbody></table><table><thead><tr><th style="text-align:center">选择安装插件方式</th></tr></thead><tbody><tr><td style="text-align:center">手动选择插件.</td></tr></tbody></table><blockquote><p>查看需要实现安装<a href>Publish Over SSH</a> 以及 <a href>Git Parameter</a></p></blockquote><table><thead><tr><th style="text-align:center">安装插件</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232754318.png" alt="image-20200708232754318"></td></tr><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232800931.png" alt="image-20200708232800931"></td></tr></tbody></table><blockquote><p>安装成功后，需要指定上用户名和密码等信息</p></blockquote><table><thead><tr><th style="text-align:center">指定用户名密码信息</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232842803.png" alt="image-20200708232842803"></td></tr><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232910197.png" alt="image-20200708232910197"></td></tr><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708232922638.png" alt="image-20200708232922638"></td></tr></tbody></table><blockquote><p>登陆成功</p></blockquote><table><thead><tr><th style="text-align:center">登录成功</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588681196639.png" alt="1588681196639"></td></tr></tbody></table><blockquote><p>登录成功后,还需要单独安装<a href>Persistent Parameter</a>插件</p></blockquote><table><thead><tr><th style="text-align:center">安装方式及安装成功图</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708233023116.png" alt="image-20200708233023116"></td></tr><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/image-20200708233031967.png" alt="image-20200708233031967"></td></tr></tbody></table><h4 id="119-配置jenkins的目标服务器"><a class="markdownIt-Anchor" href="#119-配置jenkins的目标服务器"></a> 11.9 配置Jenkins的目标服务器</h4><blockquote><p>执行过程：代码提交到Gitlab，Jenkins会从Gitlab中拉取代码，并在Jenkins中打包并发布到目标服务器中。</p></blockquote><h5 id="1191-点击左侧的系统设置"><a class="markdownIt-Anchor" href="#1191-点击左侧的系统设置"></a> 11.9.1 点击左侧的系统设置</h5><table><thead><tr><th style="text-align:center">左侧导航</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588681954779.png" alt="1588681954779"></td></tr></tbody></table><h5 id="1192-选中中间区域的系统设置"><a class="markdownIt-Anchor" href="#1192-选中中间区域的系统设置"></a> 11.9.2 选中中间区域的系统设置</h5><table><thead><tr><th style="text-align:center">系统设置</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588681970621.png" alt="1588681970621"></td></tr></tbody></table><h5 id="1193-搜索publish-over-ssh"><a class="markdownIt-Anchor" href="#1193-搜索publish-over-ssh"></a> 11.9.3 搜索Publish over SSH</h5><table><thead><tr><th style="text-align:center">Publish over SSH</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588682011820.png" alt="1588682011820"></td></tr></tbody></table><h5 id="1194-点击上图新增"><a class="markdownIt-Anchor" href="#1194-点击上图新增"></a> 11.9.4 点击上图新增</h5><table><thead><tr><th>新增SSH连接</th></tr></thead><tbody><tr><td><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588682092002.png" alt="1588682092002"></td></tr></tbody></table><h4 id="1110-配置gitlab免密码登录"><a class="markdownIt-Anchor" href="#1110-配置gitlab免密码登录"></a> 11.10 配置GitLab免密码登录</h4><blockquote><p>链接Gitlab需要使用密码，我们可以通过SSH的方式，免密码登陆Gitlab拉取代码，避免每次都输入密码。</p></blockquote><h5 id="11101登录jenkins容器内部"><a class="markdownIt-Anchor" href="#11101登录jenkins容器内部"></a> 11.10.1登录Jenkins容器内部</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it jenkins bash</span><br></pre></td></tr></table></figure><h5 id="11102-输入生成ssh秘钥命令"><a class="markdownIt-Anchor" href="#11102-输入生成ssh秘钥命令"></a> 11.10.2 输入生成SSH秘钥命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;邮箱（随便写）&quot;</span><br></pre></td></tr></table></figure><h5 id="11103将秘钥复制到gitlab的ssh中"><a class="markdownIt-Anchor" href="#11103将秘钥复制到gitlab的ssh中"></a> 11.10.3将秘钥复制到GitLab的SSH中</h5><table><thead><tr><th style="text-align:center">配置密钥</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588683585249.png" alt="1588683585249"></td></tr></tbody></table><h4 id="1111-配置jdk和maven"><a class="markdownIt-Anchor" href="#1111-配置jdk和maven"></a> 11.11 配置JDK和Maven</h4><blockquote><p>我们需要再Jenkins中将代码打包，需要依赖JDK和Maven的环境</p></blockquote><h5 id="11111-复制软件到data目录下"><a class="markdownIt-Anchor" href="#11111-复制软件到data目录下"></a> 11.11.1 复制软件到data目录下</h5><table><thead><tr><th style="text-align:center">效果</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588684490466.png" alt="1588684490466"></td></tr></tbody></table><h5 id="11112-在监控界面中配置jdk和maven"><a class="markdownIt-Anchor" href="#11112-在监控界面中配置jdk和maven"></a> 11.11.2 在监控界面中配置JDK和Maven</h5><table><thead><tr><th style="text-align:center">配置环境变量</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588684458028.png" alt="1588684458028"></td></tr></tbody></table><h5 id="11113-手动拉取gitlab项目"><a class="markdownIt-Anchor" href="#11113-手动拉取gitlab项目"></a> 11.11.3 手动拉取gitlab项目</h5><blockquote><p>使用SSH无密码连接时，第一次连接需要手动确定</p></blockquote><table><thead><tr><th style="text-align:center">手动拉取一次</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588685220324.png" alt="1588685220324"></td></tr></tbody></table><h4 id="1112-创建maven任务"><a class="markdownIt-Anchor" href="#1112-创建maven任务"></a> 11.12 创建maven任务</h4><blockquote><p>实现通过Jenkins的Maven任务，自动去Gitlab拉取代码，并在本地打包，发布到目标服务器上</p></blockquote><h5 id="11121-创建maven工程推送到gitlab中"><a class="markdownIt-Anchor" href="#11121-创建maven工程推送到gitlab中"></a> 11.12.1 创建maven工程，推送到GitLab中</h5><blockquote><p>随便创建一个即可……</p></blockquote><h5 id="11122-jenkins的监控页面中创建maven任务"><a class="markdownIt-Anchor" href="#11122-jenkins的监控页面中创建maven任务"></a> 11.12.2 Jenkins的监控页面中创建maven任务</h5><table><thead><tr><th style="text-align:center">指定GitLab地址</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588686481506.png" alt="1588686481506"></td></tr></tbody></table><table><thead><tr><th style="text-align:center">指定maven打包方式</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588686489821.png" alt="1588686489821"></td></tr></tbody></table><h5 id="11123-执行maven任务"><a class="markdownIt-Anchor" href="#11123-执行maven任务"></a> 11.12.3 执行maven任务</h5><table><thead><tr><th style="text-align:center">立即构建，并查看日志</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588686591351.png" alt="1588686591351"></td></tr></tbody></table><table><thead><tr><th style="text-align:center">控制台查看日志信息</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588686553880.png" alt="1588686553880"></td></tr></tbody></table><h5 id="11124-最终效果"><a class="markdownIt-Anchor" href="#11124-最终效果"></a> 11.12.4 最终效果</h5><table><thead><tr><th style="text-align:center">打包成功</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588687382594.png" alt="1588687382594"></td></tr></tbody></table><h4 id="1113-实现持续交付持续部署"><a class="markdownIt-Anchor" href="#1113-实现持续交付持续部署"></a> 11.13 实现持续交付持续部署</h4><blockquote><p>实现根据tag标签，实现持续交付和持续部署</p></blockquote><h5 id="11131-安装persistent-parameter的插件"><a class="markdownIt-Anchor" href="#11131-安装persistent-parameter的插件"></a> 11.13.1 安装Persistent Parameter的插件</h5><table><thead><tr><th style="text-align:center">安装插件</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588693533099.png" alt="1588693533099"></td></tr></tbody></table><h5 id="11132-重新指定构建项目的方式"><a class="markdownIt-Anchor" href="#11132-重新指定构建项目的方式"></a> 11.13.2 重新指定构建项目的方式</h5><table><thead><tr><th style="text-align:center">根据标签构建项目</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588696879059.png" alt="1588696879059"></td></tr></tbody></table><table><thead><tr><th style="text-align:center">自定义构建</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588697752850.png" alt="1588697752850"></td></tr></tbody></table><h5 id="11133-构建项目成功后需要将内容发布到目标服务器"><a class="markdownIt-Anchor" href="#11133-构建项目成功后需要将内容发布到目标服务器"></a> 11.13.3 构建项目成功后，需要将内容发布到目标服务器</h5><table><thead><tr><th style="text-align:center">发布服务器后执行的命令</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588697770621.png" alt="1588697770621"></td></tr></tbody></table><h5 id="11134-添加程序代码"><a class="markdownIt-Anchor" href="#11134-添加程序代码"></a> 11.13.4 添加程序代码</h5><blockquote><p>指定目标服务器的Dockerfile以及docker-compose.yml文件。</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile 文件</span></span><br><span class="line"><span class="string">FROM</span> <span class="string">daocloud.io/library/tomcat:8.5.15-jre8</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">testcd-1.0-SNAPSHOT.war</span> <span class="string">/usr/local/tomcat/webapps</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-compose.yml文件</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">"3.1"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  testcd:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">docker</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">testcd</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8081</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure><h5 id="11135-测试"><a class="markdownIt-Anchor" href="#11135-测试"></a> 11.13.5 测试</h5><blockquote><p>在Jenkins中指定Tag后，Jenkins会从Gitlab拉取指定版本分支，并打包推送到目标服务器。</p></blockquote><table><thead><tr><th style="text-align:center">根据标签修改发布版本</th></tr></thead><tbody><tr><td style="text-align:center"><img src="http://qgw3wcroi.hn-bkt.clouddn.com/1588700462690.png" alt="1588700462690"></td></tr></tbody></table></div><div class="article-footer"></div></article><section id="comments"></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2020/11/26/2020–10-05-软链接解决磁盘不足/" title="软链接解决磁盘不足"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/2020/11/26/2020–07-24-Wow 插件开发/" title="Wow 插件开发-清理背包插件"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/Demo233" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://www.weibo.com/u/5592904662/home" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/cnnqjban521" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.facebook.com/yihao.zhao.7" target="_blank" title="Facebook" data-toggle="tooltip" data-placement="top"><i class="icon icon-facebook"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var n={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=n}(window)</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.js"></script><script src="//cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"b6eff4e9fc3dae3c8764",clientSecret:"1d0201dabf2358e2f833a3b2e51b99126d85045a",repo:"Demo233.github.io",owner:"Demo233",admin:["Demo233"],id:md5(location.pathname),distractionFreeMode:!0});gitalk.render("comments")</script></body></html><!-- rebuild by neat -->